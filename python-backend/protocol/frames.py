from abc import ABCMeta
from protocol.Utils.utils import *
from struct import pack, unpack
class commonFrame(metaclass=ABCMeta):
    FRAME_TYPES = { "data": 0, "header": 1, "cfg1": 2, "cfg2": 3, "cfg3": 5, "cmd": 4 }
    FRAME_TYPES_WORDS = { code: word for word, code in FRAME_TYPES.items() }
    
    def __init__(self, data):
        self.get_SYNC(data[0:2])
        self.get_FRAMESIZE(data[2:4])
        self.get_IDCODE(data[4:6])
        self.get_SOC(data[6:10])
        self.get_FRACSEC(data[10:14])
    
    def get_SYNC(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.frame_type = int(data[0:8], 2)
        self.frame_version = int(data[9:12], 2)
    
    def get_FRAMESIZE(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.framesize = int(data, 2)
    
    def get_IDCODE(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.stream_idcode = int(data, 2)
    
    def get_SOC(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.soc = int(data, 2)
    
    def get_FRACSEC(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.msg_tq = int(data[:8])
        self.fracsec = int(data[8:32], 2)
    
    def get_CHK(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.chk = int(data, 2)
    
    def __str__(self):
        return f"""\
FRAME INFORMATION 
* Frame Version : {self.frame_version}
* Frame Type : {commandFrame.FRAME_TYPES_WORDS[self.frame_type]}
* Frame size : {self.framesize}
* Stream ID Code : {self.stream_idcode}
* SOC : {self.soc}
* Time quality : {self.msg_tq}
* FRACSEC : {self.fracsec}\n
    """

class pmuCfg(object):
    
    def __init__(self, data, start):
        self.start = start
        self.get_STN(data[start : start + 16])
        start += 16
        self.get_Data_IDCODE(data[start : start + 2])
        start += 2
        self.get_FORMAT(data[start : start + 2])
        start += 2
        self.get_PHNMR(data[start : start + 2])
        start += 2
        self.get_ANNMR(data[start : start + 2])
        start += 2
        self.get_DGNMR(data[start : start + 2])
        start += 2
        len = 16 * (self.phnmr + self.annmr + self.dgnmr * 16)
        self.get_CHNAM(data[start : start + len])
        start += len
        self.get_PHUNIT(data[start : start + 4 * self.phnmr])
        start += 4 * self.phnmr
        self.get_ANUNIT(data[start : start + 4 * self.annmr])
        start += 4 * self.annmr
        self.get_DIGUNIT(data[start : start + 4 * self.dgnmr])
        start += 4 * self.dgnmr
        self.get_FNOM(data[start : start + 2])
        start += 2
        self.get_CFGCNT(data[start : start + 2])
        start += 2
        self.end = start
    
    def get_STN(self, data):
        self.stn = data.decode('ascii', errors='ignore')
    
    def get_Data_IDCODE(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.data_idcode = int(data, 2)
        assert 1 <= self.data_idcode <= 65534, f"data idcode = {self.data_idcode} is out of range (1, 65534)"
    
    def get_FORMAT(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        data = data[::-1]
        self.format = data[0:4]
    
    def get_PHNMR(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.phnmr = int(data, 2)
        assert 0 <= self.phnmr <= 65535, f"Number of phasors = {self.phnmr} is out of range (0, 65535)" 
    
    def get_ANNMR(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.annmr = int(data, 2)
        assert 0 <= self.annmr <= 65535, f"Number of analog phasors = {self.annmr} is out of range (0, 65535)" 
    
    def get_DGNMR(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.dgnmr = int(data, 2)
        assert 0 <= self.dgnmr <= 65535, f"Number of digital phasors = {self.dgnmr} is out of range (0, 65535)" 
    
    def get_CHNAM(self, data):
        def parse(data):
            return data.decode('utf-8', errors='ignore')
        self.chnam = {
            "phasor": [],
            "analog": [],
            "digital": []
        }
        cur = 0
        for i in range(self.phnmr):
            phname = data[cur : cur + 16]
            self.chnam["phasor"].append(parse(phname))
            cur += 16
        for i in range(self.annmr):
            anname = data[cur : cur + 16]
            self.chnam["analog"].append(parse(anname))
            cur += 16
        for i in range(self.dgnmr):
            dgnames = []
            for _ in range(16):
                dgname = data[cur : cur + 16]
                dgnames.append(parse(dgname))
                cur += 16
            self.chnam["digital"].append(dgnames)
        return cur
    
    def get_PHUNIT(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.phunit = []
        start = 0
        for _ in range(self.phnmr):
            _data = data[start: start + 32]
            
            phasor_type = int(_data[0:8], 2)
            if self.format[3] != '0':
                scale = None
            else:
                scale = int(_data[8:32], 2) * 1e-5
            assert scale == None or 0 <= scale <= 16777215, f"scale of phasor = {scale} is out of range (0, 16777215)"
            unit_type = "i" if phasor_type != 0 else "v"
            self.phunit.append((scale, unit_type))
            start += 32
    
    def get_ANUNIT(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        def signed_24bit(val):
            if val & (1 << 23):
                return val - (1 << 24)
            return val
        self.anunit = []
        TYPES = { "0": "pow", "1": "rms", "2": "peak" }
        start = 0
        
        for _ in range(self.annmr):
            _data = data[start: start + 32]
            
            analog_type = int(_data[0:8], 2)
            scale = signed_24bit(int(_data[8:32], 2))
            
            assert -8388608 <= scale <= 8388608, f"scale of AnalogUnit = {scale} is out of range (-8388608, 8388608)"

            res = scale, TYPES[analog_type]  
            start += 32
            self.anunit.append(res)

    def get_DIGUNIT(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.dgunit = []
        start = 0
        for _ in range(self.dgnmr):
            word1 = data[start : start + 16]
            start += 16
            word2 = data[start : start + 16]
            start += 16
            res = int(word1, 2), int(word2, 2)
            self.dgunit.append(res)

    def get_FNOM(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.fnom = 60 if data[15] == '0' else 50

    def get_CFGCNT(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.cfgcnt = int(data, 2)
    
    def __str__(self):
        res = f'''
\t- Station Name: {self.stn}
\t- Data stream code: {self.data_idcode}
\t- Phasor Units: {self.phunit}
\t- Analog Units: {self.anunit}
\t- Digital Units: {self.dgunit}
    '''
        res += f"\t- Phasors:- {self.phnmr}\n"
        for i in range(len(self.chnam['phasor'])):
            res += f"\t\t{i}: {self.chnam['phasor'][i]}\n"

        res += f"\t- Analog:- {self.annmr}\n"
        for i in range(len(self.chnam['analog'])):
            res += f"\t\t{i}: {self.chnam['analog'][i]}\n"

        res += f"\t- Digital:- {self.dgnmr}\n"
        for i in range(len(self.chnam['digital'])):
            res += f"\t\t{i}: {self.chnam['digital'][i]}\n"
        return res

class cfg1(commonFrame):
    def __init__(self, data):
        super().__init__(data[0:14])
        self.get_TIME_BASE(data[14:18])
        self.get_NUM_PMU(data[18:20])
        self.time = decode_synchrophasor_time(self.soc, self.fracsec, self.time_base)
        self.pmus = []
        start = 20
        for _ in range(self.num_pmu):
            ipmu = pmuCfg(data, start)
            start = ipmu.end
            self.pmus.append(ipmu)

        self.get_DATA_RATE(data[start : start + 2])
        start += 2
        self.get_CHK(data[start : start + 2])
        start += 2
        self.ok = (start == self.framesize)
        assert start == self.framesize,  "Error in extracting frame details"
    
    def get_TIME_BASE(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.time_base = int(data[8:32], 2)
    
    def get_NUM_PMU(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        self.num_pmu = int(data, 2)
    
    def get_DATA_RATE(self, data):
        self.data_rate = unpack("!h", data)[0]
    
    def __str__(self):
        res = super().__str__()
        res += f'''
Time Base: {self.time_base}
Data rate: {self.data_rate}
Numbers of pmus: {self.num_pmu}
        '''
        for i in range(len(self.pmus)):
            res += f"PMU ID : {i}"
            res += str(self.pmus[i])
        return res
    
class pmuData(object):
    
    MEASUREMENT_STATUS = { "ok": 0, "error": 1, "test": 2, "verror": 3 }
    MEASUREMENT_STATUS_WORDS = { code: word for word, code in MEASUREMENT_STATUS.items() }

    UNLOCKED_TIME = { "<10": 0, "<100": 1, "<1000": 2, ">1000": 3 }
    UNLOCKED_TIME_WORDS = { code: word for word, code in UNLOCKED_TIME.items() }

    TIME_QUALITY = { "n/a": 0, "<100ns": 1, "<1us": 2, "<10us": 3, "<100us": 4, "<1ms": 5, "<10ms": 6, ">10ms": 7}
    TIME_QUALITY_WORDS = { code: word for word, code in TIME_QUALITY.items() }

    TRIGGER_REASON = { "manual": 0, "magnitude_low": 1, "magnitude_high": 2, "phase_angle_diff": 3,
                    "frequency_high_or_log": 4, "df/dt_high": 5, "reserved": 6, "digital": 7 }
    TRIGGER_REASON_WORDS = { code: word for word, code in TRIGGER_REASON.items() }

    def __init__(self, data, start, phnmr, annmr, dgnmr, format):
        self.start = start
        self.phnmr = phnmr
        self.annmr = annmr
        self.dgnmr = dgnmr
        self.format = format
        self.phr_type = ('rectangular' if format[0] == '0' else 'polar')
        self.phr_datatype = ('int' if format[1] == '0' else 'float')
        self.ang_datatype = ('int' if format[2] == '0' else 'float')
        self.freq_datatype = ('int' if format[3] == '0' else 'float')
        self.freq_bits = (2 if self.freq_datatype == 'int' else 4)
        self.ang_bits = (2 if self.ang_datatype == 'int' else 4)
        self.phr_bits = (4 if self.phr_datatype == 'int' else 8)
        
        self.data_bits_len = 2 + self.phr_bits * phnmr + self.freq_bits * 2 + self.ang_bits * annmr + 2 * dgnmr
        self.phasors = []
        
        self.get_STAT(data[start : start + 2])
        start += 2
        
        self.get_PHASORS(data[start : start + self.phr_bits * self.phnmr])
        start += self.phr_bits * self.phnmr

        self.get_FREQ(data[start : start + self.freq_bits])
        start += self.freq_bits
        
        self.get_DFREQ(data[start : start + self.freq_bits])
        start += self.freq_bits
        
        self.get_ANALOG(data[start : start + self.ang_bits * self.annmr])
        start += self.ang_bits * self.annmr

        self.get_DIGITAL(data[start : start + 2 * self.dgnmr])
        start += 2 * self.dgnmr
        self.end = start

    def get_STAT(self, somedata):
        data_bits = ''.join(bin(byte)[2:].zfill(8) for byte in somedata)
        # data_bits = data_bits[::-1]
        self.is_triggered = True if int(data_bits[11], 2) else False
        self.sorting = "arrival" if int(data_bits[11], 2) else "time stamp"
        self.config_change = (data_bits[10] == '1')
        self.is_modified = (data_bits[9] == '1')
        self.data_error = pmuData.MEASUREMENT_STATUS_WORDS[int(data_bits[14:16], 2)]
        self.trigger_reason = pmuData.TRIGGER_REASON_WORDS[int(data_bits[0:4], 2)]
        self.unlocked_time = pmuData.UNLOCKED_TIME_WORDS[int(data_bits[4:6], 2)]
        self.time_quality = pmuData.TIME_QUALITY_WORDS[int(data_bits[6:9], 2)]
        self.PMU_sync = True if int(data_bits[13], 2) else False
        return

    def get_PHASORS(self, data):
        for i in range(self.phnmr):
            start = i * self.phr_bits
            end = start + self.phr_bits

            val = ''.join(bin(byte)[2:].zfill(8) for byte in data[start : end])
            val = int(val, 2).to_bytes((len(val) + 7) // 8, byteorder="big")

            if self.format[1] == '1':
                val = unpack("!ff", val)
            elif self.phr_type == 'polar':
                val = unpack("!Hh", val)
            else:
                val = unpack("!hh", val)
            val = (float(val[0]), float(val[1]))
            self.phasors.append(val)
    
    def get_FREQ(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        data = int(data, 2)
        if self.freq_datatype == 'float':
            self.freq = unpack('!f', pack('!I', data))[0]
        else:
            self.freq = unpack("!h", pack("!H", data))[0]

    def get_DFREQ(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        data = int(data, 2)
        if self.freq_datatype == 'float':
            self.rocof = unpack('!f', pack('!I', data))[0]
        else:
            self.rocof = unpack("!h", pack("!H", data))[0]

    def get_ANALOG(self, data):
        self.analog = []
        for i in range(self.annmr):
            start = i * (2 if self.ang_datatype == 'int' else 4)
            end = start + (2 if self.ang_datatype == 'int' else 4)
            _data = data[start: end]
            if self.ang_datatype == 'float':
                _data = unpack('!f', pack('!I', _data))[0]
            else:
                _data = unpack("!h", pack("!H", data))[0]
            _data = float(_data)
            self.analog.append(_data)
    
    def get_DIGITAL(self, data):
        self.digital = []
        for i in range(self.dgnmr):
            start = i * 2
            end = start + 2
            _data = data[start: end]
            if self.ang_datatype == 'float':
                _data = unpack('!f', pack('!I', _data))[0]
            else:
                _data = unpack("!h", pack("!H", data))[0]
            _data = float(_data)
            self.digital.append(_data)
            
    def __str__(self):
        return f"""
    - Data Error: {self.data_error}
    - Sorted by: {self.sorting}
    - Trigger detected: {self.is_triggered}
    - Trigger Reason: {self.trigger_reason}
    - Time Quality: {self.time_quality}
    - Unlocked Time: {self.unlocked_time}
    - PMU Sync: {self.PMU_sync}
    - Frequency: {self.freq}
    - ROCOF: {self.rocof}
    - Phasors: {self.phasors}
    - Analog: {self.analog}
    - Digital: {self.digital}
        """
class dataFrame(commonFrame):
    
    def __init__(self, data, pmuinfo, time_base=1000000, num_pmu=1):
        '''
        data = byte (0, 1, 2 ... bit)
        '''
        super().__init__(data[0:14])
        self.start = 14
        self.time_base = time_base
        self.time = decode_synchrophasor_time(self.soc, self.fracsec, self.time_base)
        self.num_pmu = num_pmu
        self.pmu_data = []
        self.start = 14
        for i in range(num_pmu):
            ipmu = pmuData(data, self.start, pmuinfo[i].phnmr, pmuinfo[i].annmr, pmuinfo[i].dgnmr, pmuinfo[i].format)
            self.start = ipmu.end
            self.pmu_data.append(ipmu)

        self.get_CHK(data[-2:])
        self.start += 2
        self.ok = (self.start == self.framesize)
        assert self.start == self.framesize, f"Error in extracting frame details, start:{self.start} != framesize:{self.framesize}"
        
        pass
    
    def __str__(self):
        res = super().__str__()
        res += "FRAME CONTENT \n"
        res += f"""\b
Time: {soc_to_dateTime(self.soc)}
PMU data:-
    """
        for i in range(len(self.pmu_data)):
            res += f"PMU ID {i} : {self.pmu_data[i]}\n"
        return res

class headerFrame(commonFrame):
    
    def __init__(self, data):
        super.__init__(data[0:14])
        self.info = data[14: self.framesize - 3].decode('ascii', errors='ignore')
        self.get_CHK(data[-2:0])
        pass
    
    
class commandFrame(commonFrame):
    
    CMD_MSG = {
        1: 'Turn off transmission of data frames.',
        2: 'Turn on transmission of data frames.',
        3: 'Send HDR frame.',
        4: 'Send CFG-1 frame.',
        5: 'Send CFG-2 frame.',
        6: 'Send CFG-3 frame.',
        7: 'Undefined',
        8: 'Extended frame.'
    }
    
    def __init__(self, data):
        super().__init__(data[0:14])
        self.get_CMD(data[14:16])
        self.get_EXTFRAME(data[16:self.framesize - 3])
        self.get_CHK(data[-2:0])
        
    def get_CMD(self, data):
        data = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        data = int(data, 2)
        if data <= 8:
            self.cmd = commandFrame.CMD_MSG[data]
        else:
            self.cmd = 'Undefined'
        return
    
    def get_EXTFRAME(self, data):
        self.extframe = ''.join(bin(byte)[2:].zfill(8) for byte in data)
        
if __name__ == "__main__":
    cfg = b'\xaa1\x00\xea\x00\x01g\xf6\xe0%\x00\x04\x11\xab\x00\x0fB@\x00\x03BUS-           1\x00\x01\x00\x0f\x00\x02\x00\x00\x00\x00Voltage         Current         \x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00BUS-           2\x00\x02\x00\x0f\x00\x02\x00\x00\x00\x00Voltage         Current         \x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00BUS-           3\x00\x03\x00\x0f\x00\x02\x00\x00\x00\x00Voltage         Current         \x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x1eP\xfe\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x08\x04\x93\xe0\x00\x00F\x1a\xd9\xc4?\xa6\x97d\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x13?\xa9%\xff\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe?\xa1\xb3\xb1\x00\x00\x00\x00\x00\x00\x00\x00Bro\x0e\x00\x00\x00\x00+\xd1\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x08\x05\x16\x15\x00\x00F\x1a\xd9\xc3?\xb6\xe7/\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x14?\xb9u\xc9\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe?\xb2\x03u\x00\x00\x00\x00\x00\x00\x00\x00Bro\x0e\x00\x00\x00\x00\x86E\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x08\x05\x98K\x00\x00F\x1a\xd9\xc3?\xc76\xfb\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x14?\xc9\xc5\x95\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xc0?\xc2S?\x00\x00\x00\x00\x00\x00\x00\x00Bro\x0e\x00\x00\x00\x00\xee\x15\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\t\x06\x1a\x80\x00\x00F\x1a\xd9\xc4?\xd7\x86\xc8\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x12?\xda\x15a\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe?\xd2\xa3\x10\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\xe3V\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\t\x06\x9c\xb5\x00\x00F\x1a\xd9\xc4?\xe7\xd6\x95\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x13?\xeae.\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xc0?\xe2\xf2\xe6\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x90d\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\t\x07\x1e\xeb\x00\x00F\x1a\xd9\xc3?\xf8&d\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x12?\xfa\xb4\xfc\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe?\xf3B\xbd\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x84\xd7\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x08\x07\xa1 \x00\x00F\x1a\xd9\xc3@\x04;\x19\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x11@\x05\x82e\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbc@\x01\xc9J\x00\x00\x00\x00\x00\x00\x00\x00Bro\x12\x00\x00\x00\x00\x19\x02\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x08\x08#U\x00\x00F\x1a\xd9\xc3@\x0cc\x00\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x10@\r\xaaM\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe@\t\xf14\x00\x00\x00\x00\x00\x00\x00\x00Bro\x12\x00\x00\x00\x00\xa7\xd7\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x08\x08\xa5\x8b\x00\x00F\x1a\xd9\xc2@\x14\x8a\xe6\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x0f@\x15\xd23\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbc@\x12\x19\x1c\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\xea\x91\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x08\t\'\xc0\x00\x00F\x1a\xd9\xc0@\x1c\xb2\xcd\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x11@\x1d\xfa\x1b\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe@\x1a@\xfc\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00v\xb3\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x08\t\xa9\xf5\x00\x00F\x1a\xd9\xc1@$\xda\xb2\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x12@&"\x00\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe@"h\xda\x00\x00\x00\x00\x00\x00\x00\x00Bro\x0e\x00\x00\x00\x00\xc6k\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\t\n,+\x00\x00F\x1a\xd9\xc3@-\x02\x97\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x13@.I\xe5\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe@*\x90\xbb\x00\x00\x00\x00\x00\x00\x00\x00Bro\x0e\x00\x00\x00\x00\xfc\x05\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\t\n\xae`\x00\x00F\x1a\xd9\xc2@5*}\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x14@6q\xcb\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe@2\xb8\xa0\x00\x00\x00\x00\x00\x00\x00\x00Bro\x0e\x00\x00\x00\x00\x03\x1b\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\t\x0b0\x95\x00\x00F\x1a\xd9\xc2@=Rc\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x14@>\x99\xb1\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xc0@:\xe0\x88\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x9a\xd0\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x08\x0b\xb2\xcb\x00\x00F\x1a\xd9\xc2@EzJ\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x13@F\xc1\x97\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe@C\x08r\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\xbe\xee\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x08\x0c5\x00\x00\x00F\x1a\xd9\xc2\xc0D}\x84\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x12\xc0C68\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xc0F\xefX\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00K\x94\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x08\x0c\xb75\x00\x00F\x1a\xd9\xc3\xc0<U\x9d\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x12\xc0;\x0eP\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xc0>\xc7l\x00\x00\x00\x00\x00\x00\x00\x00Bro\x12\x00\x00\x00\x00_\x97\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x08\r9k\x00\x00F\x1a\xd9\xc2\xc04-\xb6\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x10\xc02\xe6i\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xc06\x9f\x82\x00\x00\x00\x00\x00\x00\x00\x00Bro\x12\x00\x00\x00\x00d\x7f\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\x07\r\xbb\xa0\x00\x00F\x1a\xd9\xc2\xc0,\x05\xd0\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x0f\xc0*\xbe\x81\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbc\xc0.w\x9a\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00A\xad\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\t\x0e=\xd5\x00\x00F\x1a\xd9\xc1\xc0#\xdd\xe9\x00\x00\x00\x00'

    # b'\xaa1\x00^\x00\x01g\xdf\xf7\x95\x00\r\xbb\xa0\x00\x0fB@\x00\x01BUS-           2\x00\x01\x00\x0f\x00\x02\x00\x00\x00\x00Voltage         Current         \x00\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x1e/\x12\xaa\x01\x00*\x00\x01g\xdf\xfe\xe8\t\x0c\xb75\x00\x00F$\xd1\xe3\xc0\x03\xe6\xc9\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xb8\x00\x00\x00\x00\xed\xe1\xaa\x01\x00*\x00\x01g\xdf\xfe\xe8\t\r9k\x00\x00F$\xd1\xe9\xc0\x19)\xaf\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xbc\x00\x00\x00\x00\xdb<\xaa\x01\x00*\x00\x01g\xdf\xfe\xe8\x08\r\xbb\xa0\x00\x00F$\xd1\xd7\xc0.l;\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xc0\x00\x00\x00\x00V&\xaa\x01\x00*\x00\x01g\xdf\xfe\xe8\x08\x0e=\xd5\x00\x00F$\xd1\xe1\xc0C\xae\xe7\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xbe\x00\x00\x00\x00\xe3\xb6\xaa\x01\x00*\x00\x01g\xdf\xfe\xe8\x08\x0e\xc0\x0b\x00\x00F$\xd1\xf5@9.1\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xc0\x00\x00\x00\x00p\xaa\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\x00\x00\x00\x00\x00F$\xd1\xea@#\xeb\xb5\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xe3\x00\x00\x00\x00^5\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\t\x00\x825\x00\x00F$\xd1\xde@\x0e\xa94\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xf2\x00\x00\x00\x00+8\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\t\x01\x04k\x00\x00F$\xd1\xda?\xf2\xcdF\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xf7\x00\x00\x00\x00\xcc^\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\t\x01\x86\xa0\x00\x00F$\xd1\xc3?\xc8H\x08\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xe8\x00\x00\x00\x00\x91\t\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\x02\x08\xd5\x00\x00F$\xd1\x91?\x9d\xc2\x8a\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xd0\x00\x00\x00\x00\xfd\xec\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\x02\x8b\x0b\x00\x00F$\xd1\xd5?fx\xe3\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xbc\x00\x00\x00\x00\\\xd0\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\x03\r@\x00\x00F$\xd1\xe5?\x11k\xd2\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xb5\x00\x00\x00\x00\xd2h\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\x03\x8fu\x00\x00F$\xd2\x05>q~\xbe\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xb5\x00\x00\x00\x00\x19\xcd\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x07\x04\x11\xab\x00\x00F$\xd1\xf3\xbd\xc5]\xcd\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xbd\x00\x00\x00\x00\r\x16\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\t\x04\x93\xe0\x00\x00F$\xd1\xca\xbe\xdbk\x80\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xc1\x00\x00\x00\x00a\x1f\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\t\x05\x16\x15\x00\x00F$\xd2\x0c\xbfB\xc0\xb2\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xbe\x00\x00\x00\x00\xc8\xfb\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\x05\x98K\x00\x00F$\xd2\x0b\xbf\x8b\xe5~\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xc2\x00\x00\x00\x00\xf6\x02\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\x06\x1a\x80\x00\x00F$\xd1\xeb\xbf\xb6jk\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xe5\x00\x00\x00\x00M\x99\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\x06\x9c\xb5\x00\x00F$\xd1\xce\xbf\xe0\xefi\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xf3\x00\x00\x00\x00\xc1\xe2\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x07\x07\x1e\xeb\x00\x00F$\xd1\xc1\xc0\x05\xbaH\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xf7\x00\x00\x00\x00\x16#\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\t\x07\xa1 \x00\x00F$\xd1\xaa\xc0\x1a\xfc\xfb\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xda\x00\x00\x00\x00\xf3\x10\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\t\x08#U\x00\x00F$\xd1\xbf\xc00?\xe6\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xc3\x00\x00\x00\x00^\xc0\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\x08\xa5\x8b\x00\x00F$\xd1\xe8\xc0E\x83*\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xac\x00\x00\x00\x007p\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\t\'\xc0\x00\x00F$\xd1\xeb@7Y\x8e\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xb4\x00\x00\x00\x004\x98\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\t\xa9\xf5\x00\x00F$\xd1\xf2@"\x16\xa3\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xb9\x00\x00\x00\x00(\x18\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\n,+\x00\x00F$\xd1\xe5@\x0c\xd4\x15\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xcc\x00\x00\x00\x00\x9fr\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\t\n\xae`\x00\x00F$\xd2\x02?\xef"\xce\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xc3\x00\x00\x00\x00\x8f\xf9\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\t\x0b0\x95\x00\x00F$\xd2#?\xc4\x9d\x94\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xc3\x00\x00\x00\x00kX\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\t\x0b\xb2\xcb\x00\x00F$\xd2\x18?\x9a\x18\x9a\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xda\x00\x00\x00\x00\xc8\xdc\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\x0c5\x00\x00\x00F$\xd1\xe7?_\'i\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xf1\x00\x00\x00\x00Yn\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\x0c\xb75\x00\x00F$\xd1\xed?\n\x1d>\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xf7\x00\x00\x00\x00.\xb8\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\r9k\x00\x00F$\xd1\xdd>TK[\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xe9\x00\x00\x00\x004\x1c\xaa\x01\x00*\x00\x01g\xdf\xfe\xe9\x08\r\xbb\xa0\x00\x00F$\xd1\xb5\xbd\xff\xc0\xd3\x00\x00\x00\x00\x00\x00\x00\x00Bi\xa7\xd0\x00\x00\x00\x00\xb2\xe2'
    cfg = cfg1(cfg)
    # print(cfg)
    # data = b'\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x11\xc0"\x96\x9c\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbc\xc0&O\xba\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00!\x8d\xaa\x01\x00^\x00\x01g\xf6\xe0\xbd\t\x0e\xc0\x0b\x00\x00F\x1a\xd9\xc2\xc0\x1b\xb6\x04\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x12\xc0\x1an\xb6\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xc0\x1e\'\xdb\x00\x00\x00\x00\x00\x00\x00\x00Bro\x0e\x00\x00\x00\x00\x18\xf9\xaa\x01\x00^\x00\x01g\xf6\xe0\xbe\x08\x00\x00\x00\x00\x00F\x1a\xd9\xc4\xc0\x13\x8e\x1f\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x13\xc0\x12F\xd1\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xc0\x15\xff\xfa\x00\x00\x00\x00\x00\x00\x00\x00Bro\x0e\x00\x00\x00\x00\x85\xe8\xaa\x01\x00^\x00\x01g\xf6\xe0\xbe\x08\x00\x825\x00\x00F\x1a\xd9\xc3\xc0\x0bf8\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x14\xc0\n\x1e\xeb\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xc0\xc0\r\xd8\x15\x00\x00\x00\x00\x00\x00\x00\x00Bro\x0e\x00\x00\x00\x00F\x87\xaa\x01\x00^\x00\x01g\xf6\xe0\xbe\x08\x01\x04k\x00\x00F\x1a\xd9\xc3\xc0\x03>R\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x13\xc0\x01\xf7\x05\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xc0\x05\xb0-\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\xf96\xaa\x01\x00^\x00\x01g\xf6\xe0\xbe\x08\x01\x86\xa0\x00\x00F\x1a\xd9\xc3\xbf\xf6,\xd7\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x14\xbf\xf3\x9e=\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xbf\xfb\x10\x87\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00g\x0c\xaa\x01\x00^\x00\x01g\xf6\xe0\xbe\t\x02\x08\xd5\x00\x00F\x1a\xd9\xc4\xbf\xe5\xdd\t\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x13\xbf\xe3No\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xbf\xea\xc0\xb0\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\xc7\xe9\xaa\x01\x00^\x00\x01g\xf6\xe0\xbe\t\x02\x8b\x0b\x00\x00F\x1a\xd9\xc3\xbf\xd5\x8d;\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x12\xbf\xd2\xfe\xa1\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xbf\xdap\xda\x00\x00\x00\x00\x00\x00\x00\x00Bro\x12\x00\x00\x00\x00P\x04\xaa\x01\x00^\x00\x01g\xf6\xe0\xbe\t\x03\r@\x00\x00F\x1a\xd9\xc2\xbf\xc5=m\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x12\xbf\xc2\xae\xd2\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xbf\xca!\x06\x00\x00\x00\x00\x00\x00\x00\x00Bro\x12\x00\x00\x00\x00t;\xaa\x01\x00^\x00\x01g\xf6\xe0\xbe\x08\x03\x8fu\x00\x00F\x1a\xd9\xc4\xbf\xb4\xed\xa0\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x11\xbf\xb2_\x03\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xbf\xb9\xd16\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00P\xaa\xaa\x01\x00^\x00\x01g\xf6\xe0\xbe\x08\x04\x11\xab\x00\x00F\x1a\xd9\xc1\xbf\xa4\x9d\xd3\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x11\xbf\xa2\x0f6\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xbf\xa9\x81u\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00X&\xaa\x01\x00^\x00\x01g\xf6\xe0\xbe\x08\x04\x93\xe0\x00\x00F\x1a\xd9\xc3\xbf\x94N\x08\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x12\xbf\x91\xbfm\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbe\xbf\x991\xb6\x00\x00\x00\x00\x00\x00\x00\x00Bro\x0e\x00\x00\x00\x00H\xb5\xaa\x01\x00^\x00\x01g\xf6\xe0\xbe\x08\x05\x16\x15\x00\x00F\x1a\xd9\xc2\xbf\x83\xfe=\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00F&+\x13\xbf\x81o\xa1\x00\x00\x00\x00\x00\x00\x00\x00Bro\x10\x00\x00\x00\x00\x00\x00E\xffx\xbc\xbf\x88\xe1\xf2\x00\x00\x00\x00\x00\x00\x00\x00Bro\x0e\x00\x00\x00\x00\xb1\x11'
    data = b'\xaa\x01\x00^\x00\x01g\xf6\xe7\x15\x08\x00\x825\x00\x00F\x1a\xd9\xc6?\xa0\xea\xe1\x00\x00\x00\x00\x00\x00\x00\x00Bro\x18\x00\x00\x00\x00\x00\x00F&+%?\xa3yz\x00\x00\x00\x00\x00\x00\x00\x00Bro\x1a\x00\x00\x00\x00\x00\x00E\xffx\xc4?\x9c\x07,\x00\x00\x00\x00\x00\x00\x00\x00Bro\x1a\x00\x00\x00\x00\xa2\xf6'
    frame = dataFrame(data, pmuinfo = cfg.pmus, time_base = cfg.time_base, num_pmu = cfg.num_pmu)
    print(frame)